{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Quiz 1102 by College\"\nauthor: \"coop711\"\ndate: \"`r Sys.Date()`\"\noutput: html_document\n---\n\n### Data\n\n* 자료 구성\n\n```{r}\nlibrary(xlsx)\nlibrary(pander)\nlibrary(ggplot2)\noptions(digits=3)\nquiz1102 <- read.xlsx(\"../data/class_roll1102.xlsx\", 1, startRow = 2, endRow = 72, colIndex = c(3:7, 9:13), colClasses=rep(\"character\", 10))\nstr(quiz1102)\nnames(quiz1102) <- c(\"dept\", \"id\", \"name\", \"year\", \"e.mail\", \"cell.no\", \"Q1\", \"Q2\", \"Q3\", \"Q4\")\nstr(quiz1102)\nq.ans <- quiz1102[paste(\"Q\", 1:4, sep=\"\")]\nq.ans.british.coop <- factor(q.ans$Q1, levels=c(\"가\", \"나\", \"다\", \"라\"), labels=c(\"90%\", \"70%\", \"50%\", \"30%\"))\nq.ans.mtr.top.income <- factor(q.ans$Q2, levels=c(\"가\", \"나\", \"다\", \"라\"), labels=c(\"높고높다\", \"낮고낮다\", \"높고낮다\", \"높으면낮다\"))\nq.ans.trickle.down <- factor(q.ans$Q3, levels=c(\"가\", \"나\", \"다\", \"라\"), labels=c(\"있다\", \"없다\", \"있는 듯\", \"계층별\"))\nq.ans.coop.retail <- factor(q.ans$Q4, levels=c(\"가\", \"나\", \"다\", \"라\"), labels=c(\"5%\", \"10%\", \"21%\", \"30%\"))\n```\n\n* 응답 내용 분석\n     + 영국 협동조합의 3년 이상 생존률에 대한 인식 양호(정답률 : 69%)\n     + 최고소득세율과 상위1% 소득점유율의 관계에 대한 인식 개선 필요(정답률 34%, 인과관계 오류) \n     + '낙수'효과에 대한 인식 개선(정답률 : 51% => 67% => 77%)\n     + 도소매 분애 협동조합의 비중에 대한 인식 개선 필요(정답률 : 56%)\n     \n```{r}\nload(\"../R/quiz1028v2.rda\")\nquiz1102.div <- data.frame(quiz1028.div[, 1:7], quiz1102[c(\"Q1\", \"Q2\", \"Q3\", \"Q4\")])\npander(table(quiz1102.div$college, quiz1102.div$Q1))\npander(table(quiz1102.div$college, quiz1102.div$Q2))\npander(table(quiz1102.div$college, quiz1102.div$Q3))\npander(table(quiz1102.div$college, quiz1102.div$Q4))\npander(mapply(function(x) xtabs(~college + x, data=quiz1102.div), quiz1102.div[c(\"Q1\", \"Q2\", \"Q3\", \"Q4\")], SIMPLIFY = FALSE))\n```\n\n\n```{r}\nq.ans.tbl <- apply(q.ans, 2, table, useNA=\"ifany\")\npander(q.ans.tbl)\npander(table(q.ans.british.coop))\npander(table(q.ans.mtr.top.income))\npander(table(q.ans.trickle.down))\npander(table(q.ans.coop.retail))\n```\n\n## 답안 분석\n\n### 정답표와 비교\n\n* 정답 구성\n    + `mapply()`를 적용하기 위하여 정답을 `list`로 분리,  \n\n```{r}\nq.key <- c(\"가\", \"다\", \"나\", \"다\")\n(q.key.l <- split(q.key, f=paste(\"A\", 1:4, sep=\"\")))\nstr(q.key.l)\n```\n\n* 작성한 답안을 정답과 비교 \n    + `mapply()`에 적용하는 함수를 `factor()`와 `ifelse()`의 합성함수로 구성된 `anonymous`로 만들되, `y = q.key.l`의 default로 잡은 점에 유의.\n\n```{r}\n(marks <- mapply(function(x, y) factor(ifelse(x == y, \"R\", \"W\")), y = q.key.l, quiz1102[c(\"Q1\", \"Q2\", \"Q3\", \"Q4\")]))\n```\n\n* 요약표 작성. 결석생들이 NA로 나타남.\n\n```{r}\n(marks.tbl <- apply(marks, 2, table, useNA=\"ifany\"))\n```\n\n* 결석생들을 제외한 요약표\n\n```{r}\n(marks.tbl.2 <- apply(marks, 2, table))\n```\n\n### `barplot()` 작성\n\n* `barplot()` 막대에 표시할 정답률 계산\n\n```{r}\nround(prop.table(marks.tbl.2, margin=2)*100, digits=1)\n(correct.ans.rate <- round(prop.table(marks.tbl.2, margin=2)[1, ]*100, digits=0))\n```\n\n* `barplot()` 막대의 `names.arg`에 들어갈 이름 구성.\n\n```{r}\nv.names <- c(\"영국협동조합의\\n3년이상생존률\", \"최고소득세율과\\n상위1%소득점유\", \"가계수지와\\n낙수효과\", \"도소매분야\\n협동조합비중\")\n```\n\n* `barplot()` 기본 골격\n\n```{r}\nbarplot(marks.tbl.2, col=c(\"cyan\", \"red\"), names.arg = v.names)\n```\n\n* 메인 타이틀과 x축, y축의 제목 추가\n\n```{r}\nbarplot(marks.tbl.2, col=c(\"cyan\", \"red\"), names.arg = v.names)\ntitle(main=\"11월 2일 퀴즈 결과\", xlab=\"문항\", ylab=\"인원\")\n```\n\n* 범례 추가\n    + 좌표는 시행착오를 거쳐서 찾아냄.\n    \n```{r}\nbarplot(marks.tbl.2, col=c(\"cyan\", \"red\"), names.arg = v.names)\ntitle(main=\"11월 2일 퀴즈 결과\", xlab=\"문항\", ylab=\"인원\")\nlegend(x=0.35,y=59, legend=c(\"오답\", \"정답\"), fill=c(\"red\", \"cyan\"))\n```\n\n* 각 막대에 정답률(%) 표시\n    + 좌표는 역시 시행착오를 거쳐 찾아냄.\n\n```{r}\nbarplot(marks.tbl.2, col=c(\"cyan\", \"red\"), names.arg = v.names)\ntitle(main=\"11월 2일 퀴즈 결과\", xlab=\"문항\", ylab=\"인원\")\nlegend(x=0.35, y=59, legend=c(\"오답\", \"정답\"), fill=c(\"red\", \"cyan\"))\ntext(x=c(0.75, 1.9, 3.1, 4.3), y=rep(10, 4), labels=paste(correct.ans.rate, \"%\", sep=\"\"))\n```\n\n\n## `ggplot()` 접근\n\n### Two types of long format \n\n* ggplot으로 그리려면 long format 필요\n    + `marks`의 자료구조가 매트릭스이므로 `reshape2::melt`의 array(matrix, table) 유형에 적용.\n    + matrix의 행이름과 열이름을 붙이는 방법에 대하여 유의하고,\n    + 행이름과 열이름이 어떻게 등장하는지 살필 것.\n    + `\"ID\"`와 `\"Items\"`를 `dimnames()`로 설정하지 않으면 `Var1`과 `Var2`로 나타나게 됨.\n    + `value.name`을 설정하지 않으면 `value`라는 변수명을 갖게 됨. 확인해 볼 것.\n\n```{r}\nlibrary(reshape2)\nstr(marks)\ndimnames(marks) <- list(\"ID\" = quiz1102$id, \"Items\" = dimnames(marks)[[2]])\n# dimnames(marks) <- list(\"ID\" = dimnames(marks)[[1]], \"Items\" = dimnames(marks)[[2]])\nstr(marks)\n(marks.long <- melt(marks, value.name=\"Marks\"))\nstr(marks.long)\n```\n\n* `ggplot` 기본 골격\n\n```{r}\n(ml.1 <- ggplot(na.omit(marks.long), aes(x=Items, fill=Marks)) + geom_bar(stat=\"bin\"))\n```\n\n* 흑백 배경 전환\n\n```{r}\n(ml.2 <- ml.1 + theme_bw())\n```\n\n* 한글로 제목과 축이름 붙이기\n\n```{r}\nsource(\"theme_kr_HCR.R\")\nls()\n(ml.3 <- ml.2 + theme.HCR.kr + xlab(\"문항\") + ylab(\"인원\") + ggtitle(\"11월 2일 퀴즈 결과\"))\n```\n\n* 한글로 막대에 문항별 이름 붙이기\n\n```{r}\n(ml.4 <- ml.3 + scale_x_discrete(labels=v.names))\n```\n\n* `legend`에 한글이름 붙이기\n\n```{r}\n(ml.5 <- ml.4 + labs(fill=\"정답여부\") + scale_fill_discrete(labels=c(\"정답\", \"오답\")))\n```\n\n* 색이 맘에 안 들면,\n\n```{r}\n(ml.6 <- ml.4 + scale_fill_manual(values=c(\"cyan\", \"red\"), labels=c(\"정답\", \"오답\")) + labs(fill=\"정답여부\"))\n```\n\n* 범례 항목의 등장 순서를 바꾸려면,\n\n```{r}\n(ml.7 <- ml.4 + scale_fill_manual(limits=c(\"W\", \"R\"), values=c(\"red\", \"cyan\"), labels=c(\"오답\", \"정답\")) + labs(fill=\"정답여부\"))\n```\n\n* 정답률을 각 막대에 새기기\n\n```{r}\n(ml.8 <- ml.7 + annotate(\"text\", x=1:4, y=rep(10, 4), label=paste(correct.ans.rate, \"%\", sep=\"\")))\n```\n\n### `marks.tbl`로 그리려면, \n\n* `marks.tbl`을 logn format으로 전환\n\n```{r, fig.width=5, fig.height=5}\nstr(marks.tbl)\ndimnames(marks.tbl) <- list(\"Marks\"= dimnames(marks.tbl)[[1]], \"Items\" = dimnames(marks.tbl)[[2]])\nstr(marks.tbl)\n(marks.tbl.long <- melt(marks.tbl, value.name=\"Counts\"))\nstr(marks.tbl.long)\n```\n\n* `ggplot` 골격\n    + `aes()`에 `y = Counts` 등장.\n\n```{r}\n(mtl.1 <- ggplot(na.omit(marks.tbl.long), aes(x = Items, y = Counts, fill = Marks)) +\n  geom_bar(stat=\"identity\"))\n```\n\n* 흑백 배경 전환\n\n```{r}\n(mtl.2 <- mtl.1 + theme_bw())\n```\n\n* 한글로 제목과 축이름 붙이기\n\n```{r}\n(mtl.3 <- mtl.2 + theme.HCR.kr + xlab(\"문항\") + ylab(\"인원\") + ggtitle(\"11월 2일 퀴즈 결과\"))\n```\n\n* 한글로 막대에 문항별 이름 붙이기\n\n```{r}\n(mtl.4 <- mtl.3 + scale_x_discrete(labels=v.names))\n```\n\n* `legend`에 한글이름 붙이기\n\n```{r}\n(mtl.5 <- mtl.4 + labs(fill=\"정답여부\") + scale_fill_discrete(labels=c(\"정답\", \"오답\")))\n```\n\n* 색이 맘에 안 들면,\n\n```{r}\n(mtl.6 <- mtl.4 + scale_fill_manual(values=c(\"cyan\", \"red\"), labels=c(\"정답\", \"오답\")) + labs(fill=\"정답여부\"))\n```\n\n* 범례 항목의 등장 순서를 바꾸려면,\n\n```{r, legend.item.order}\n(mtl.7 <- mtl.4 + scale_fill_manual(limits=c(\"W\", \"R\"), values=c(\"red\", \"cyan\"), labels=c(\"오답\", \"정답\")) + labs(fill=\"정답여부\"))\n```\n\n* 정답률을 각 막대에 새기기\n\n```{r, final.ggplot}\n(mtl.8 <- mtl.7 + annotate(\"text\", x=1:4, y=rep(10, 4), label=paste(correct.ans.rate, \"%\", sep=\"\")))\n```\n\n## 자료 갈무리\n\n```{r, save.image}\nsave.image(\"quiz_1102v2.rda\")\n```\n",
    "created" : 1446391588052.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1216842498",
    "id" : "EE7B2A7A",
    "lastKnownWriteTime" : 1446648350,
    "path" : "~/Desktop/Works/Class/Statistics/R.WD/Class_data/class201502/R/quiz_1102v2.Rmd",
    "project_path" : "R/quiz_1102v2.Rmd",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}